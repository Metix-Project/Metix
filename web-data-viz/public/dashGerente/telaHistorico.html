<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Métix Proteção Divina</title>
    <link rel="icon" href="../assets/imgs/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


    <!--Script Gerador WordCloud -->
    <link rel="shortcut icon" href="../img/icoNumeEtiqueta.ico" type="image/x-icon">
    
    <script src="../js/scrypt.js"></script>
    <script src="../js/sessao.js"></script>
    <link rel="stylesheet" href="../css/dashboardBase.css">
    <link rel="stylesheet" href="../css/telaHistorico.css">

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <img src="assets/imgs/Logo1.png" alt="">
            </div>

            <div class="profile">
                <img alt="Profile" id="profileImage">
                <div class="prfTxt">
                    <h2 id="profileName">Olá, Usuário!</h2>
                    <h4 id="profilePosition">Cargo: Gerente</h4>
                </div>
            </div>

            <div class="dashboardLinks">
                <a>MONITORAMENTO EM TEMPO REAL</a>
                <a>ALERTAS</a>
                <a href="./dashGerente/historico.html">HISTÓRICO</a>
                <a>PREVISÕES</a>
                <a>MANUTENÇÃO</a>
                <a onclick="limparSessao()">Sair</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h1>Histórico dos Dados dos Servidores</h1>
            <div class="graphics1">
                <div class="filtros">
                    <h3>Filtros</h3>
                    <div class="filtro selects">
                        <span>Selecione o Servidor: </span>
                        <select id="selectServer">
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="filtro selects">
                        <span>Selecione a Métrica: </span>
                        <select id="selectHardware">
                            <option value="1">Uso da CPU</option>
                            <option value="2">Uso da Memória RAM</option>
                            <option value="3">Uso do Disco Rígido</option>
                            <option value="4">Frequência da CPU</option>
                            <option value="5">Latência do Servidor</option>
                        </select>
                    </div>
                    <div class="filtro" id="dualHandleSlider">
                        <input type="range" min="1" max="90" value="30">
                        <span class="rangeLegend">
                            Últimos
                            <input type="number" min="1" max="90" value="30" id="dayValue">
                            dias
                        </span>
                    </div>
                </div>
                <div class="metricas">
                    <div class="cards">
                        <div class="card">
                            <span>Uso médio da CPU</span>
                            <span class="infoValue" id="cpuUsageValue">55%</span>
                        </div>
                        <div class="card">
                            <span>Uso médio da RAM</span>
                            <span class="infoValue" id="ramUsageValue">12.7 GB</span>
                        </div>
                        <div class="card">
                            <span>Uso médio do Disco</span>
                            <span class="infoValue" id="diskUsageValue">598 GB</span>
                        </div>
                        <div class="card">
                            <span>Média de GHz da CPU</span>
                            <span class="infoValue" id="cpuFreqValue">1.3 GHz</span>
                        </div>
                        <div class="card">
                            <span>Latência Média</span>
                            <span class="infoValue" id="internetValue">5 Ms</span>
                        </div>
                    </div>
                    <div class="dados">
                        <canvas id="historicoComponenteEscolhido"></canvas>
                        <div class="warnings">
                            <div class="warningCard">
                                <span class="title">Percentual de Tempo em Funcionamento Normal</span>
                                <span class="cardValue" id="percentValue">89%</span>
                            </div>
                            <div class="warningCard">
                                <span class="title">Tempo total fora dos Limites Ideais</span>
                                <span class="cardValue" id="timeValue">3h 45min 54s</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    window.onload = validarSessao();

    // SLIDER
    window.addEventListener("load", () => document.querySelectorAll("#dualHandleSlider").forEach(dualHandleSlider => {
        const input = dualHandleSlider.querySelector("input[type='range']");
        const dayValue = document.getElementById("dayValue")
        
        input.addEventListener("input", () => {
            dayValue.value = input.value
        })

        dayValue.addEventListener("input", () => {
            input.value = dayValue.value;
        })
    }));

    var historicoComponenteEscolhido = document.getElementById('historicoComponenteEscolhido').getContext('2d');
    historicoComponenteEscolhido.canvas.parentNode.style.height = '450px';

    var labels = [];
    var valores = [];

    var minValues = [];
    var maxValues = [];

    for(var i = 0; i < 90; i++){
        labels[i] = i;
        maxValues[i] = 85;
        minValues[i] = 5;

        if(!i) valores[i] = Math.random() * 99 + 1
        else {
            if(valores[i - 1] > 95){
                valores[i] = valores[i - 1] - (Math.random() * 10 + 1 )
            }
            else if(valores[i - 1] < 5) {
                valores[i] = valores[i - 1] + (Math.random() * 10 + 1)
            }
            else {
                if(Math.random() < 0.5){
                    valores[i] = valores[i - 1] + (Math.random() * 4 + 1)
                } else {
                    valores[i] = valores[i - 1] - (Math.random() * 4 + 1)
                }
            }
        }
    }

    new Chart(
        historicoComponenteEscolhido,
        {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: "Componente X (%)",
                        borderWidth: 4,
                        borderColor: '#593f1e',
                        backgroundColor: 'rgba(89, 63, 30, 0.5)',
                        fill: true,
                        lineTension: 0.3,
                        data: valores
                    },
                    {
                        label: "Máximo",
                        borderWidth: 3,
                        borderColor: '#211300',
                        data: maxValues,
                        pointBorderWidth: 0,
                        pointBackgroundColor: 'transparent'
                    },
                    {
                        label: "Mínimo",
                        borderWidth: 3,
                        borderColor: '#a17c4c',
                        data: minValues,
                        pointBorderWidth: 0,
                        pointBackgroundColor: 'transparent'
                    }
                ]
            },
            options: {
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: "Dias",
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    y: {
                        min: 0,
                        max: 100,
                        title: {
                            display: true,
                            text: "Percentual de Uso",
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        ticks: {
                            stepSize: 10
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        backgroundColor: '#fff'
                    }
                },
                responsive: true
            }
        }
    )

    // var historicoComponenteEscolhido = document.getElementById('historicoComponenteEscolhido').getContext('2d');
    // historicoComponenteEscolhido.canvas.parentNode.style.width = '45%';
    // historicoComponenteEscolhido.canvas.parentNode.style.height = '500px';
</script>
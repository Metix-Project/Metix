<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Métix Proteção Divina</title>
    <link rel="icon" href="../assets/imgs/logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


    <!--Script Gerador WordCloud -->
    <link rel="shortcut icon" href="../img/icoNumeEtiqueta.ico" type="image/x-icon">
    
    <script src="../js/scrypt.js"></script>
    <script src="../js/sessao.js"></script>
    <link rel="stylesheet" href="../css/dashboardBase.css">
    <link rel="stylesheet" href="../css/telaHistorico.css">

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="profile">
                <img alt="Profile" id="profileImage">
                <h2 id="profileName">Usuário</h2>
                <h4 id="profilePosition">Cargo: Gerente</h4>
                <h4 id="profileBusiness">Banco</h4>
            </div>

            <div class="dashboardLinks">
                <h2>Dashboards</h2>
                <button>MONITORAMENTO EM TEMPO REAL</button>
                <button>ALERTAS</button>
                <button onclick="window.location.href = 'telaHistorico.html'">HISTÓRICO</button>
                <button>PREVISÕES</button>
                <button>MANUTENÇÃO</button>
                <button onclick="limparSessao()">Sair</button>
            </div>
            <div class="logo">
                <img src="../assets/imgs/Logo1.png" alt="Metix Logo">
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h1>Histórico dos Dados dos Servidores</h1>
            <div class="graphics1">
                <div class="filtros">
                    <div class="filtro selects">
                        <span>Selecione o Servidor: </span>
                        <select id="selectServer">
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="filtro selects">
                        <span>Selecione a Métrica: </span>
                        <select id="selectHardware">
                            <option value="1">Uso da CPU</option>
                            <option value="2">Uso da Memória RAM</option>
                            <option value="3">Uso do Disco Rígido</option>
                            <option value="4">Frequência da CPU</option>
                            <option value="5">Latência do Servidor</option>
                            <option value="6">Rede</option>
                        </select>
                    </div>
                    <div class="filtro" id="dualHandleSlider">
                        <input type="range" min="7" max="90" value="30">
                        <span class="rangeLegend">
                            Últimos
                            <input type="number" min="7" max="90" value="30" id="dayValue">
                            dias
                        </span>
                    </div>
                </div>
                <div class="metricas">
                    <div class="cards">
                        <div class="subCards">
                            <div class="card">
                                <span>Uso médio da CPU</span>
                                <span class="infoValue" id="cpuUsageValue">55%</span>
                            </div>
                            <div class="card">
                                <span>Uso médio da RAM</span>
                                <span class="infoValue" id="ramUsageValue">12.7 GB</span>
                            </div>
                            <div class="card">
                                <span>Uso médio do Disco</span>
                                <span class="infoValue" id="diskUsageValue">598 GB</span>
                            </div>
                        </div>
                        <div class="subCards">
                            <div class="card">
                                <span>Média de GHz da CPU</span>
                                <span class="infoValue" id="cpuFreqValue">1.3 GHz</span>
                            </div>
                            <div class="card">
                                <span>Latência Média</span>
                                <span class="infoValue" id="internetValue">5 Ms</span>
                            </div>
                            <div class="card">
                                <span>Rede</span>
                                <span class="infoValue" id="internetValue">70 MB</span>
                            </div>
                        </div>
                    </div>
                    <div class="dados">
                        <canvas id="historicoComponenteEscolhido"></canvas>
                        <div class="moreInfo">
                            <div class="warnings">
                                <div class="infoCard">
                                    <span class="title">Percentual de Tempo em Funcionamento Normal</span>
                                    <span class="cardValue" id="percentValue">89%</span>
                                </div>
                                <div class="infoCard">
                                    <span class="title">Tempo total fora dos Limites Ideais</span>
                                    <span class="cardValue" id="timeValue">3h 45min 54s</span>
                                </div>
                            </div>
                            <div class="infoCard">
                                <span class="title">Sugestão do Gemini</span>
                                <span class="cardValue" id="geminiText">Fazer Upgrade!</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    window.onload = validarSessao();
    var componente = "CPU";
    var dia = 30;

    // SLIDER
    
    var historicoComponenteEscolhido = document.getElementById('historicoComponenteEscolhido').getContext('2d');
    historicoComponenteEscolhido.canvas.parentNode.style.height = '400px';

    var labels = [];
    var valores = [];

    var minValues = [];
    var maxValues = [];

    function gerarDados(){
        for(var i = 0; i < dia; i++){
            var data = new Date();
            data.setDate(data.getDate() - (dia - 1 - i));
            labels[i] = data.toLocaleDateString();
            maxValues[i] = 85;
            minValues[i] = 5;

            if(!i) valores[i] = Math.random() * 99 + 1
            else {
                if(valores[i - 1] > 95){
                    valores[i] = valores[i - 1] - (Math.random() * 10 + 1 )
                }
                else if(valores[i - 1] < 5) {
                    valores[i] = valores[i - 1] + (Math.random() * 10 + 1)
                }
                else {
                    if(Math.random() < 0.5){
                        valores[i] = valores[i - 1] + (Math.random() * 4 + 1)
                    } else {
                        valores[i] = valores[i - 1] - (Math.random() * 4 + 1)
                    }
                }
            }
        }
    }

    async function gerarGrafico(){
        await gerarDados();

        new Chart(
            historicoComponenteEscolhido,
            {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: "Componente X (%)",
                            borderWidth: 4,
                            borderColor: 'rgba(200, 190, 220, 0.8)',
                            backgroundColor: 'rgba(200, 190, 220, 0.2)',
                            fill: true,
                            lineTension: 0.3,
                            data: valores
                        },
                        {
                            label: "Máximo",
                            borderWidth: 3,
                            borderColor: 'rgb(200, 0, 0)',
                            data: maxValues,
                            pointBorderWidth: 0,
                            pointBackgroundColor: 'transparent'
                        },
                        {
                            label: "Mínimo",
                            borderWidth: 3,
                            borderColor: 'rgb(0, 200, 0)',
                            data: minValues,
                            pointBorderWidth: 0,
                            pointBackgroundColor: 'transparent'
                        }
                    ]
                },
                options: {
                    scales: {
                        x: {
                            grid: {
                                display: false,
                            },
                            title: {
                                display: true,
                                text: "Dias",
                                color: 'white',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                }
                            },
                            ticks: {
                                color: 'white'
                            },
                            border: {
                                color: 'white',
                                width: 1
                            },
                        },
                        y: {
                            border: {
                                color: 'white',
                                width: 1
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)',
                                lineWidth: 1
                            },
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: "Percentual de Uso",
                                color: 'white',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                stepSize: 10,
                                color: 'white'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: '#3f3b36'
                        },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 15
                                }
                            },
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: `Últimos Dados Capturados do Componente`,
                            font: {
                                size: 25,
                                weight: 'bold'
                            },
                            color: 'white'
                        }
                    },
                    responsive: true
                }
            }
        )
    }

    window.addEventListener("load", () => document.querySelectorAll("#dualHandleSlider").forEach(dualHandleSlider => {
        const input = dualHandleSlider.querySelector("input[type='range']");
        const dayValue = document.getElementById("dayValue");
        
        input.addEventListener("input", () => {
            dayValue.value = input.value;
            dia = input.value;
        })

        dayValue.addEventListener("input", () => {
            input.value = dayValue.value;
            dia = dayValue.value;
        })
    }));

    gerarGrafico();

    

    // var historicoComponenteEscolhido = document.getElementById('historicoComponenteEscolhido').getContext('2d');
    // historicoComponenteEscolhido.canvas.parentNode.style.width = '45%';
    // historicoComponenteEscolhido.canvas.parentNode.style.height = '500px';
</script>
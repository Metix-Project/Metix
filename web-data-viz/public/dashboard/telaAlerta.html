<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Métix Proteção Divina</title>
  <link rel="icon" href="../assets/imgs/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>

  <!-- scripts do Chart.js - 2022-1 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- CSS Dependencies Modal-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <!--Script Gerador WordCloud -->
  <link rel="shortcut icon" href="../img/icoNumeEtiqueta.ico" type="image/x-icon">

  <script src="../js/script.js"></script>
  <script src="../js/sessao.js"></script>
  <link rel="stylesheet" href="../css/dashboardBase.css">
</head>

<body
  onload="listarRanking(), listarQtdPorServidor(), listarTodos(), listarPorEstadoAlerta(), listarPorEstadoRisco(), listarUltimas24Horas()">

  <div class="containerA">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="profile">
        <img alt="Profile" id="profileImage">
        <h2 id="profileName">Usuario</h2>
        <h4 id="profilePosition">Cargo: Gerente</h4>
        <h4 id="profileBusiness">Banco</h4>
      </div>

      <div class="dashboardLinks">
        <h2>Dashboards</h2>
        <button onclick="window.location.href = 'dashAtualizadaTecnico.html'">Monitoramento</button>
        <button class="actual">Alertas</button>
        <button onclick="window.location.href = 'telaHistorico.html'">Histórico</button>
        <button onclick="window.location.href = 'telaPrevisao.html'">Previsões</button>
        <button onclick="window.location.href = 'telaManutencao.html'">Manutenção</button>
        <button onclick="limparSessao()">Sair</button>
      </div>
      <div class="logo">
        <img src="assets/imgs/Logo1.png" alt="Metix Logo">
      </div>
    </div>


    <main class="main-content">
      <!-- Summary Cards -->
      <div class="status-cards">
        <div class="status-card yellow">
          <h3 id="TotalAlerta">00</h3>
          <p>COMPONENTES EM ESTADO DE ALERTA</p>
          <button class="bttnModalOpenY" onclick="openModalYellow()"> Visualizar </button>

          <dialog id="modalYellow">
            <div class="container-fluid py-4">
              <div class="card">
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="dataTableYellow" class="table table-hover table-striped" style="width:100%">
                      <thead>
                        <tr>
                          <th>Categoria</th>
                          <th>Componente</th>
                          <th>Servidor</th>
                          <th>Motivo</th>
                          <th>DataHora</th>
                          <th>idAlerta</th>
                          <th>MacAddress</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <button class="bttnModalClose" onclick="modalYellow.close()"> Fechar visualização de dados </button>
          </dialog>
        </div>

        <div class="status-card red">
          <h3 id="TotalRisco">00</h3>
          <p>COMPONENTES EM ESTADO DE RISCO</p>
          <button class="bttnModalOpenD" onclick="openModalRed()"> Visualizar </button>

          <dialog id="modalRed">
            <div class="container-fluid py-4">
              <div class="card">
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="dataTableRed" class="table table-hover table-striped" style="width:100%">
                      <thead>
                        <tr>
                          <th>Categoria</th>
                          <th>Componente</th>
                          <th>Servidor</th>
                          <th>Motivo</th>
                          <th>DataHora</th>
                          <th>idAlerta</th>
                          <th>MacAddress</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <button class="bttnModalClose" onclick="modalRed.close()"> Fechar visualização de dados </button>
          </dialog>
        </div>

        <div class="status-card recent">
          <h3 id="Total24Horas">00</h3>
          <p>ALERTAS DAS ÚLTIMAS 24 HORAS</p>
          <button class="bttnModalOpenR" onclick="openModalRecent()"> Visualizar </button>

          <dialog id="modalRecent">
            <div class="container-fluid py-4">
              <div class="card">
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="dataTableRecent" class="table table-hover table-striped" style="width:100%">
                      <thead>
                        <tr>
                          <th>Categoria</th>
                          <th>Componente</th>
                          <th>Servidor</th>
                          <th>Motivo</th>
                          <th>DataHora</th>
                          <th>idAlerta</th>
                          <th>MacAddress</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <button class="bttnModalClose" onclick="modalRecent.close()"> Fechar visualização de dados </button>
          </dialog>
        </div>

        <div class="status-card green">
          <h3 id="TotalTodos">00</h3>
          <p>TODOS OS ALERTAS JÁ GERADOS</p>
          <button class="bttnModalOpenG" onclick="openModalGreen()"> Visualizar </button>

          <dialog id="modalGreen">
            <div class="container-fluid py-4">
              <div class="card">
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="dataTableGreen" class="table table-hover table-striped" style="width:100%">
                      <thead>
                        <tr>
                          <th>Categoria</th>
                          <th>Componente</th>
                          <th>Servidor</th>
                          <th>Motivo</th>
                          <th>DataHora</th>
                          <th>idAlerta</th>
                          <th>MacAddress</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <button class="bttnModalClose" onclick="modalGreen.close()"> Fechar visualização de dados </button>
          </dialog>
        </div>
      </div>

      <!-- Charts -->
      <div class="charts">
        <div class="chart ranking">
          <div class="ranking-filter">
            <h4>Ranking dos motivos</h4>
            <div class="filters">
              <select id="selectPeriodo1" onchange="listarRanking()">
                <option value="7" selected>Semana</option>
                <option value="30">Mês</option>
              </select>
              <select id="selectServidor1" onchange="listarRanking()">
                <!-- <option>Todos os Servidores</option> -->
                <option value="f946307321c2" id="Servidor_1" selected>Servidor 1</option>
                <option value="14857f833746">Servidor 2</option>
                <option value="d09466c9be45">Servidor 3</option>
                <option value="c7d12465a943">Servidor 4</option>
              </select>
            </div>
          </div>
          <div class="chart-placeholder">
            <div class="chart-container-ranking">
              <canvas id="chartRanking"></canvas>
            </div>
          </div>
        </div>

        <div class="chart period">
          <div class="period-filter">
            <h4>Quantidade de alertas </h4>
            <div class="filters">

              <select id="selectPeriodo2" onchange="listarQtdPorServidor()">
                <option value="7" selected>Semana</option>
                <option value="30">Mês</option>
              </select>

              <select id="selectServidor2" onchange="listarQtdPorServidor()">
                <option value="Todos" selected> Todos os Servidores</option>
                <option value="f946307321c2">Servidor 1</option>
                <option value="14857f833746">Servidor 2</option>
                <option value="d09466c9be45">Servidor 3</option>
                <option value="c7d12465a943">Servidor 4</option>
              </select>
            </div>
          </div>
          <div class="chart-container-period">
            <canvas id="chartQtd"></canvas>
          </div>
        </div>
      </div>


    </main>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
</body>

</html>

<style>
  body {
    background-color: #191715;
  }

  .sidebar .dashboardLinks .actual {
    background-color: #6C493A;
    font-weight: bold;
    padding-bottom: 30px;
    width: 105%;
  }

  .containerA {
    display: flex;
    width: 100vw;
    height: 100vh;
  }

  /* Status Cards */
  .status-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
  }

  .status-card {
    background-color: #2c2c2c;
    /* Fundo cinza claro */
    padding: 20px;
    border-radius: 10px 10px 10px 10px;
    /* Bordas superiores arredondadas */
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    border-top: 10px solid;
    /* Define a borda superior */
  }

  .status-card.green {
    border-top-color: #4c9b1e;
    /* Cor verde para "Estado Estável" */
  }

  .status-card.green h3 {
    color: #4c9b1e;
  }

  .status-card.green p {
    color: #59a62d;
  }

  .status-card.yellow {
    border-top-color: #c08a26;
    /* Cor laranja para "Estado de Alerta" */
  }

  .status-card.yellow h3 {
    color: #c08a26;
  }

  .status-card.yellow p {
    color: #c08a26;
  }

  .status-card.red {
    border-top-color: #7b2c2c;
    /* Cor vermelha para "Estado de Risco" */
  }

  .status-card.red h3 {
    color: #832b2b;
  }

  .status-card.red p {
    color: #854545;
  }

  .status-card.recent {
    border-top-color: #3aa385;
    /* Cor azul para "Alertas Recentes" */
  }

  .status-card.recent h3 {
    color: #3aa385;
    /* Cor azul para "Alertas Recentes" */
  }

  .status-card.recent p {
    color: #3aa385;
    /* Cor azul para "Alertas Recentes" */
  }

  .status-card h3 {
    font-size: 48px;
    color: rgb(0, 0, 0);
    margin: 0;
  }

  .status-card p {
    font-size: 14px;
    color: rgb(0, 0, 0);
    margin: 10px 0 0;
  }

  .bttnModalOpenG {
    margin-top: 15px;
    width: 80%;
    border-radius: 50px;
    padding: 5px;
    background-color: #4c9b1e;
    border: #7fc755 solid 2px;
  }

  .bttnModalOpenY {
    margin-top: 15px;
    width: 80%;
    border-radius: 50px;
    padding: 5px;
    background-color: #c08a26;
    border: #e0b461 solid 2px;
  }

  .bttnModalOpenD {
    margin-top: 15px;
    width: 80%;
    border-radius: 50px;
    padding: 5px;
    background-color: #832b2b;
    border: #854545 solid 2px;
  }

  .bttnModalOpenR {
    margin-top: 15px;
    width: 80%;
    border-radius: 50px;
    padding: 5px;
    background-color: #3aa385;
    border: #68b9a2 solid 2px;
  }

  .bttnModalClose {
    width: 20%;
    border-radius: 50px;
    padding: 5px;
    border: white solid 2px;
  }

  #modalGreen {
    width: 90%;
    height: 90%;
    background-color: #4c9b1e;
    border-radius: 5px;
    padding: 20px;
  }

  #modalYellow {
    width: 90%;
    height: 90%;
    background-color: #c08a26;
    border-radius: 5px;
    padding: 20px;
  }

  #modalRed {
    width: 90%;
    height: 90%;
    background-color: #7b2c2c;
    border-radius: 5px;
    padding: 20px;
  }

  #modalRecent {
    width: 90%;
    height: 90%;
    background-color: #3aa385;
    border-radius: 5px;
    padding: 20px;
  }

  /*Table Modal*/
  /*Tabela*/
  /* General Styles */
  .bg-grey {
    background-color: #f8f9fa;
  }

  .bg-green-light {
    background-color: #d4edda;
  }

  .text-green {
    color: #28a745;
  }

  /* Card Styles */
  .card {
    transition: all 0.3s ease;
    border-radius: 10px;
    cursor: pointer;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .active-filter {
    border: 2px solid #007bff;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
  }

  /* Typography */
  .subtitle {
    font-size: 0.875rem;
  }

  /* Table Styles */
  .table th {
    font-weight: 600;
    background-color: #f8f9fa;
  }

  .table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.05);
  }

  /* Button Styles */
  #btnClearFilter {
    transition: all 0.2s ease;
  }

  #btnClearFilter:hover {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .card {
      margin-bottom: 1rem;
    }

    .table-responsive {
      border: 0;
    }
  }

  /*Graphics Chart.JS*/

  .canvas {
    background-color: #3aa385;
  }


  .charts {
    display: flex;
    justify-content: space-between;
    margin-top: 2%;
    gap: 15px;
    margin-left: -5px;
  }

  .chart {
    background: #2c2c2c;
    margin: 0.3%;
    padding: 20px;
    border-radius: 8px;
    width: 50%;
  }

  .chart-placeholder {
    border-radius: 8px;
  }

  .chart h4 {
    width: 40%;
  }

  .chart-container-period {
    width: 90%;
    margin-left: 5%;
  }

  .chart-container-ranking {
    width: 100%;
  }

  .ranking-filter {
    display: flex;
  }

  .ranking-filter h4 {
    font-size: 13px;
  }

  .period-filter {
    display: flex;
  }

  .period-filter h4 {
    font-size: 13px;
  }

  .filters {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-bottom: 10px;
    width: 100%;
  }

  .filters label {
    display: flex;
    flex-direction: column;
    font-size: 16px;
    color: #000;
    font-weight: bold;
    align-items: center;
    text-align: center;
  }

  .filters select {
    margin-top: 5px;
    background-color: #5a3921;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 5px;
    font-size: 12px;
    text-align: center;
    cursor: pointer;
    width: 100%;
  }

  .filters select:hover {
    background-color: #4a2f1b;
  }

  .filters select:focus {
    outline: none;
    box-shadow: 0 0 4px #fff;
  }


  .transaction-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  .transaction-table th,
  .transaction-table td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
  }

  .transaction-table th {
    background: #2c2c2c;
    color: #bcb8b4;
  }

  .last-alert {
    display: flex;
    gap: 735px;
    margin-bottom: -10px;
  }

  .last-alert a {
    text-decoration: none;
    font-style: normal;
    color: white;
    background-color: #876d59;
    padding: 8px;
    border-radius: 12px;
  }

  .last-alert a:hover {
    color: #443027;
    cursor: pointer;
  }
</style>

<script>
  var macAddress = document.getElementById('selectServidor1').value;
  var macAddress2 = document.getElementById('selectServidor2').value;

  function modificarServidor() {
    var macAddress = selectServidor1.value;
    console.log("macAddress: " + macAddress)
    listarRanking(macAddress);
  }


  window.onload = validarSessao();
  const labels1 = ['Servidor 1', 'Servidor 2', 'Servidor 3', 'Servidor 4'];

  const data1 = {
    labels: labels1,
    datasets: [
      {
        label: 'CPU',
        data: [65, 45, 25, 50],
        backgroundColor: '#FFDA6B', // Cor para 'CPU'
      },
      {
        label: 'RAM',
        data: [59, 70, 50, 10],
        backgroundColor: '#C0B2A0', // Cor para 'RAM'
      },
      {
        label: 'DISCO',
        data: [80, 60, 40, 20],
        backgroundColor: '#f9922c', // Cor para 'DISCO'
      },
      {
        label: 'LATENCIA',
        data: [81, 50, 90, 90],
        backgroundColor: '#F8A8BA', // Cor para 'LATENCIA'
      },
      {
        label: 'REDE',
        data: [81, 50, 90, 45],
        backgroundColor: '#05d0de', // Cor para 'LATENCIA'
      }
    ]
  };

  const config1 = {
    type: 'bar',
    data: data1,
    options: {
      indexAxis: 'y', // Inverte os eixos (horizontal)
      responsive: true,
      scales: {
        x: {
          stacked: true, // Empilha no eixo X
          beginAtZero: true // Garante que comece do zero
        },
        y: {
          stacked: true // Empilha no eixo Y
        }
      }
    }
  };

  const chartQtd = new Chart(
    document.getElementById('chartQtd').getContext('2d'),
    config1
  );


  // chart 2

  let labelsData2 = [];
  const data2 = {
    labels: labelsData2,
    datasets: [
      {
        label: 'Acima da Media',
        data: [],
        // backgroundColor: [
        //   '#FFDA6B', // CPU ACIMA
        //   '#FFDA6B', // CPU ABAIXO
        //   '#C0B2A0', // RAM ACIMA
        //   '#C0B2A0', // RAM ABAIXO
        //   '#f9922c', // DISCO ACIMA
        //   '#f9922c', // DISCO ABAIXO
        //   '#F8A8BA', // LATENCIA ACIMA
        //   '#F8A8BA' // LATENCIA ABAIXO
        // ],
        // borderColor: [
        //   '#FFDA6B',
        //   '#FFDA6B',
        //   '#C0B2A0',
        //   '#C0B2A0',
        //   '#f9922c',
        //   '#f9922c',
        //   '#F8A8BA',
        //   '#F8A8BA'
        // ],
        backgroundColor: '#f25c54',
        // borderWidth: 1,
      },
      {
        label: 'Abaixo da Media',
        data: [],
        backgroundColor: '#d8e2dc',
        // backgroundColor: [
        //   '#FFDA6B', // CPU ACIMA
        //   '#FFDA6B', // CPU ABAIXO
        //   '#C0B2A0', // RAM ACIMA
        //   '#C0B2A0', // RAM ABAIXO
        //   '#f9922c', // DISCO ACIMA
        //   '#f9922c', // DISCO ABAIXO
        //   '#F8A8BA', // LATENCIA ACIMA
        //   '#F8A8BA' // LATENCIA ABAIXO
        // ],
        // borderColor: [
        //   '#FFDA6B',
        //   '#FFDA6B',
        //   '#C0B2A0',
        //   '#C0B2A0',
        //   '#f9922c',
        //   '#f9922c',
        //   '#F8A8BA',
        //   '#F8A8BA'
        // ],
        // borderWidth: 1,
      }
    ]
  };

  const config2 = {
    type: 'bar', // Gráfico de barras
    data: data2,
  };

  const chartRanking = new Chart(
    document.getElementById('chartRanking'),
    config2
  );


  //RANKING
  function listarRanking() {
    console.log("macAddress: " + macAddress)
    var macAddressVar = selectServidor1.value;
    if (macAddressVar == undefined) {
      macAddressVar = Servidor_1.value;
    }
    var periodoVar = selectPeriodo1.value;
    if (periodoVar == undefined) {
      periodoVar = 7;
    }

    console.log("macAddress Atualizado: " + macAddressVar)
    fetch(`/alertaRouter/listarRanking/${macAddressVar}/${periodoVar}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json()
            .then(function (resposta) {
              console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
              resposta.reverse();

              while (labelsData2.pop() !== undefined);
              while (data2.datasets[0].data.pop() !== undefined);
              while (data2.datasets[1].data.pop() !== undefined);

              console.log(resposta);

              for (i = 0; i < resposta.length; i++) {
                var registro = resposta[i];

                if (!labelsData2.includes(registro.Componente)) {
                  labelsData2.push(registro.Componente);
                }

                if (registro.Motivo == "ACIMA DA MEDIA") {
                  data2.datasets[0].data[labelsData2.indexOf(registro.Componente)] = registro.Quantidade;
                } else {
                  data2.datasets[1].data[labelsData2.indexOf(registro.Componente)] = registro.Quantidade;
                }
              }

              chartRanking.update();
            });
        } else {
          throw "Houve erro ao puxar";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

  }

  //QTD
  function listarQtdPorServidor() {
    console.log("macAddress: " + macAddress)
    var periodoVar = selectPeriodo2.value;
    if (periodoVar == undefined) {
      periodoVar = 7;
    }
    var macAddressVar = selectServidor2.value;
    if (macAddressVar == "Todos") {
      fetch("alertaRouter/listarServidoresPorPeriodo", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          periodo: periodoVar
        })
      })
        .then(function (response) {
          if (response.ok) {
            response.json().then((resultado) => {
              const alertasServ1 = []
              const alertasServ2 = [];
              const alertasServ3 = [];
              const alertasServ4 = [];

              resultado.forEach(item => {
                if (item.Servidor === "f946307321c2") alertasServ1.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "14857f833746") alertasServ2.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "d09466c9be45") alertasServ3.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "c7d12465a943") alertasServ4.push([item.Componente, item.TotalAlertas]);
              });

              let alertasServ1CPU = 0;
              let alertasServ1RAM = 0;
              let alertasServ1DISCO = 0;
              let alertasServ1LATENCIA = 0;
              let alertasServ1REDE = 0;

              for (var i = 0; i < alertasServ1.length; i++) {
                if (alertasServ1[i][0] === 'CPU') {
                  alertasServ1CPU += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'RAM') {
                  alertasServ1RAM += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'DISCO') {
                  alertasServ1DISCO += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'LATENCIA') {
                  alertasServ1LATENCIA += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'REDE') {
                  alertasServ1REDE += alertasServ1[i][1];
                }
              }

              let alertasServ2CPU = 0;
              let alertasServ2RAM = 0;
              let alertasServ2DISCO = 0;
              let alertasServ2LATENCIA = 0;
              let alertasServ2REDE = 0;

              for (var i = 0; i < alertasServ2.length; i++) {
                if (alertasServ2[i][0] === 'CPU') {
                  alertasServ2CPU += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'RAM') {
                  alertasServ2RAM += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'DISCO') {
                  alertasServ2DISCO += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'LATENCIA') {
                  alertasServ2LATENCIA += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'REDE') {
                  alertasServ2REDE += alertasServ2[i][1];
                }
              }

              let alertasServ3CPU = 0;
              let alertasServ3RAM = 0;
              let alertasServ3DISCO = 0;
              let alertasServ3LATENCIA = 0;
              let alertasServ3REDE = 0;

              for (var i = 0; i < alertasServ3.length; i++) {
                if (alertasServ3[i][0] === 'CPU') {
                  alertasServ3CPU += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'RAM') {
                  alertasServ3RAM += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'DISCO') {
                  alertasServ3DISCO += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'LATENCIA') {
                  alertasServ3LATENCIA += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'REDE') {
                  alertasServ3REDE += alertasServ1[i][1];
                }
              }

              let alertasServ4CPU = 0;
              let alertasServ4RAM = 0;
              let alertasServ4DISCO = 0;
              let alertasServ4LATENCIA = 0;
              let alertasServ4REDE = 0;

              for (var i = 0; i < alertasServ4.length; i++) {
                if (alertasServ4[i][0] === 'CPU') {
                  alertasServ4CPU += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'RAM') {
                  alertasServ4RAM += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'DISCO') {
                  alertasServ4DISCO += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'LATENCIA') {
                  alertasServ4LATENCIA += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'REDE') {
                  alertasServ4REDE += alertasServ4[i][1];
                }
              }

              chartQtd.data.datasets[0].data = [alertasServ1CPU, alertasServ2CPU, alertasServ3CPU, alertasServ4CPU];
              chartQtd.data.datasets[1].data = [alertasServ1RAM, alertasServ2RAM, alertasServ3RAM, alertasServ4RAM];
              chartQtd.data.datasets[2].data = [alertasServ1DISCO, alertasServ2DISCO, alertasServ3DISCO, alertasServ4DISCO];
              chartQtd.data.datasets[3].data = [alertasServ1LATENCIA, alertasServ2LATENCIA, alertasServ3LATENCIA, alertasServ4LATENCIA];
              chartQtd.data.datasets[4].data = [alertasServ1REDE, alertasServ2REDE, alertasServ3REDE, alertasServ4REDE];



              chartQtd.update();
            })
          }
          else {
            throw "Erro ao pegar dados de listarQtdPorServidor";
          }
        })
        .catch(function (erro) {
          console.error(erro);
        })

    } else {
      fetch("alertaRouter/listarQtdPorServidor", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          servidor: macAddressVar, periodo: periodoVar
        })
      })
        .then(function (response) {
          if (response.ok) {
            response.json().then((resultado) => {
              console.log(resultado);
              const alertasServ1 = []
              const alertasServ2 = [];
              const alertasServ3 = [];
              const alertasServ4 = [];

              resultado.forEach(item => {
                if (item.Servidor === "f946307321c2") alertasServ1.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "14857f833746") alertasServ2.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "d09466c9be45") alertasServ3.push([item.Componente, item.TotalAlertas]);
                else if (item.Servidor === "c7d12465a943") alertasServ4.push([item.Componente, item.TotalAlertas]);
              });

              let alertasServ1CPU = 0;
              let alertasServ1RAM = 0;
              let alertasServ1DISCO = 0;
              let alertasServ1LATENCIA = 0;
              let alertasServ1REDE = 0;

              for (var i = 0; i < alertasServ1.length; i++) {
                if (alertasServ1[i][0] === 'CPU') {
                  alertasServ1CPU += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'RAM') {
                  alertasServ1RAM += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'DISCO') {
                  alertasServ1DISCO += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'LATENCIA') {
                  alertasServ1LATENCIA += alertasServ1[i][1];
                }
                else if (alertasServ1[i][0] === 'REDE') {
                  alertasServ1REDE += alertasServ1[i][1];
                }
              }

              let alertasServ2CPU = 0;
              let alertasServ2RAM = 0;
              let alertasServ2DISCO = 0;
              let alertasServ2LATENCIA = 0;
              let alertasServ2REDE = 0;

              for (var i = 0; i < alertasServ2.length; i++) {
                if (alertasServ2[i][0] === 'CPU') {
                  alertasServ2CPU += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'RAM') {
                  alertasServ2RAM += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'DISCO') {
                  alertasServ2DISCO += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'LATENCIA') {
                  alertasServ2LATENCIA += alertasServ2[i][1];
                }
                else if (alertasServ2[i][0] === 'REDE') {
                  alertasServ2REDE += alertasServ2[i][1];
                }
              }

              let alertasServ3CPU = 0;
              let alertasServ3RAM = 0;
              let alertasServ3DISCO = 0;
              let alertasServ3LATENCIA = 0;
              let alertasServ3REDE = 0;

              for (var i = 0; i < alertasServ3.length; i++) {
                if (alertasServ3[i][0] === 'CPU') {
                  alertasServ3CPU += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'RAM') {
                  alertasServ3RAM += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'DISCO') {
                  alertasServ3DISCO += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'LATENCIA') {
                  alertasServ3LATENCIA += alertasServ3[i][1];
                }
                else if (alertasServ3[i][0] === 'REDE') {
                  alertasServ3REDE += alertasServ1[i][1];
                }
              }

              let alertasServ4CPU = 0;
              let alertasServ4RAM = 0;
              let alertasServ4DISCO = 0;
              let alertasServ4LATENCIA = 0;
              let alertasServ4REDE = 0;

              for (var i = 0; i < alertasServ4.length; i++) {
                if (alertasServ4[i][0] === 'CPU') {
                  alertasServ4CPU += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'RAM') {
                  alertasServ4RAM += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'DISCO') {
                  alertasServ4DISCO += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'LATENCIA') {
                  alertasServ4LATENCIA += alertasServ4[i][1];
                }
                else if (alertasServ4[i][0] === 'REDE') {
                  alertasServ4REDE += alertasServ4[i][1];
                }
              }

              chartQtd.data.datasets[0].data = [alertasServ1CPU, alertasServ2CPU, alertasServ3CPU, alertasServ4CPU];
              chartQtd.data.datasets[1].data = [alertasServ1RAM, alertasServ2RAM, alertasServ3RAM, alertasServ4RAM];
              chartQtd.data.datasets[2].data = [alertasServ1DISCO, alertasServ2DISCO, alertasServ3DISCO, alertasServ4DISCO];
              chartQtd.data.datasets[3].data = [alertasServ1LATENCIA, alertasServ2LATENCIA, alertasServ3LATENCIA, alertasServ4LATENCIA];
              chartQtd.data.datasets[4].data = [alertasServ1REDE, alertasServ2REDE, alertasServ3REDE, alertasServ4REDE];



              chartQtd.update();
            })
          }
          else {
            throw "Erro ao pegar dados de listarQtdPorServidor";
          }
        })
        .catch(function (erro) {
          console.error(erro);
        })
    }

  }





  // MODAL KPI´S

  const sampleDataGreen = [];
  const sampleDataYellow = [];
  const sampleDataRed = [];
  const sampleDataRecent = [];

  function initializeDataTableGreen() {
    $('#dataTableGreen').DataTable({
      data: sampleDataGreen,
      columns: [
        { data: 'Categoria' },
        { data: 'Componente' },
        { data: 'Servidor' },
        { data: 'Motivo' },
        { data: 'DataHora' },
        { data: 'IdAlerta' },
        { data: 'MacAddress' }
      ]
    });
  }

  function openModalGreen() {
    const modalGreen = document.getElementById('modalGreen');
    modalGreen.showModal();
    if (!$.fn.DataTable.isDataTable('#dataTableGreen')) {
      initializeDataTableGreen();
    } else {
      $('#dataTableGreen').DataTable().draw();
    }
  }

  function initializeDataTableYellow() {
    $('#dataTableYellow').DataTable({
      data: sampleDataYellow,
      columns: [
        { data: 'Categoria' },
        { data: 'Componente' },
        { data: 'Servidor' },
        { data: 'Motivo' },
        { data: 'DataHora' },
        { data: 'IdAlerta' },
        { data: 'MacAddress' }
      ]
    });
  }

  function openModalYellow() {
    const modalYellow = document.getElementById('modalYellow');
    modalYellow.showModal();
    if (!$.fn.DataTable.isDataTable('#dataTableYellow')) {
      initializeDataTableYellow();
    } else {
      $('#dataTableYellow').DataTable().draw();
    }
  }

  function initializeDataTableRed() {
    $('#dataTableRed').DataTable({
      data: sampleDataRed,
      columns: [
        { data: 'Categoria' },
        { data: 'Componente' },
        { data: 'Servidor' },
        { data: 'Motivo' },
        { data: 'DataHora' },
        { data: 'IdAlerta' },
        { data: 'MacAddress' }
      ]
    });
  }

  function openModalRed() {
    const modalRed = document.getElementById('modalRed');
    modalRed.showModal();
    if (!$.fn.DataTable.isDataTable('#dataTableRed')) {
      initializeDataTableRed();
    } else {
      $('#dataTableRed').DataTable().draw();
    }
  }

  function initializeDataTableRecent() {
    $('#dataTableRecent').DataTable({
      data: sampleDataRecent,
      columns: [
        { data: 'Categoria' },
        { data: 'Componente' },
        { data: 'Servidor' },
        { data: 'Motivo' },
        { data: 'DataHora' },
        { data: 'IdAlerta' },
        { data: 'MacAddress' }
      ]
    });
  }

  function openModalRecent() {
    const modalRecent = document.getElementById('modalRecent');
    modalRecent.showModal();
    if (!$.fn.DataTable.isDataTable('#dataTableRecent')) {
      initializeDataTableRecent();
    } else {
      $('#dataTableRecent').DataTable().draw();
    }
  }

  //MODAL
  function listarTodos() {
    var macAddressVar = macAddress;
    fetch("/alertaRouter/listarTodos", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json()
            .then(function (resposta) {
              console.log(resposta);
              document.getElementById("TotalTodos").textContent = resposta.length; // Atualiza o card de Todos os Alertas
              resposta.forEach(item => {
                sampleDataGreen.push(
                  {
                    Categoria: item.Categoria,
                    Componente: item.Componente,
                    Servidor: item.Servidor,
                    Motivo: item.Motivo,
                    DataHora: item.DataHora,
                    IdAlerta: item.idAlerta,
                    MacAddress: item.MacAddress
                  }
                )
              })
            });
        } else {
          throw "Houve erro ao puxar";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }





  function listarPorEstadoAlerta() {
    var macAddressVar = macAddress;
    fetch("/alertaRouter/listarPorEstadoAlerta", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json()
            .then(function (resposta) {
              console.log(resposta);
              document.getElementById("TotalAlerta").textContent = resposta.length; // Atualiza o card de estado de Alerta
              resposta.forEach(item => {
                sampleDataYellow.push(
                  {
                    Categoria: item.Categoria,
                    Componente: item.Componente,
                    Servidor: item.Servidor,
                    Motivo: item.Motivo,
                    DataHora: item.DataHora,
                    IdAlerta: item.idAlerta,
                    MacAddress: item.MacAddress
                  }
                )
              })
            });
        } else {
          throw "Houve erro ao puxar";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }





  function listarPorEstadoRisco() {
    var macAddressVar = macAddress;
    fetch("/alertaRouter/listarPorEstadoRisco", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json()
            .then(function (resposta) {
              console.log(resposta);
              document.getElementById("TotalRisco").textContent = resposta.length; // Atualiza o card de estado de Risco
              resposta.forEach(item => {
                sampleDataRed.push(
                  {
                    Categoria: item.Categoria,
                    Componente: item.Componente,
                    Servidor: item.Servidor,
                    Motivo: item.Motivo,
                    DataHora: item.DataHora,
                    IdAlerta: item.idAlerta,
                    MacAddress: item.MacAddress
                  }
                )
              })
            });
        } else {
          throw "Houve erro ao puxar";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }



  function listarUltimas24Horas() {
    var macAddressVar = macAddress;
    fetch("/alertaRouter/listarUltimas24Horas", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      }
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json()
            .then(function (resposta) {
              console.log(resposta);
              document.getElementById("Total24Horas").textContent = resposta.length; // Atualiza o card de alertas das últimas 24 horas
              resposta.forEach(item => {
                sampleDataRecent.push(
                  {
                    Categoria: item.Categoria,
                    Componente: item.Componente,
                    Servidor: item.Servidor,
                    Motivo: item.Motivo,
                    DataHora: item.DataHora,
                    IdAlerta: item.idAlerta,
                    MacAddress: item.MacAddress
                  }
                )
              })
            });
        } else {
          throw "Houve erro ao puxar";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }


</script>